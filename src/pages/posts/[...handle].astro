---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import PageLayout from "../../layouts/PageLayout.astro";
import Notification from "../../components/Notification.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");

  return posts.map((post) => ({
    params: { handle: post.slug },
    props: { post },
  }));
}

// TODO: Look into AI recommended posts at the bottom of the page.

interface Props {
  post: CollectionEntry<"posts">
}

const {
  post: {
    data: { title, description, date, published },
    render,
  },
} = Astro.props;

const { Content } = await render();
const formattedDate = date.toISOString();

export const prerender = true;
---

<PageLayout
  title={title}
  description={description}
  image={`https://image.luxass.dev/api/image/post?title=${title}&date=${formattedDate}&description=${description}`}
>
  <div class="prose tracking-wide">
    {
      !published && (
        <Notification type="important">
          This post is a <strong>draft</strong>. It may be incomplete or contain
          inaccuracies.
        </Notification>
      )
    }

    <h1 class="mt-8">{title}</h1>
    <Content />
  </div>

  <section>
    Insert the latest posts here.
  </section>
</PageLayout>
