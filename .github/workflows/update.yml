name: Trigger Vercel Build

on:
  workflow_dispatch:
  # schedule:
    # Every night at 1:23
    # - cron: "23 1 * * *"

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.ROBOBUB_TOKEN }}
      - run: corepack enable
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: pnpm

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          run_install: true

      - name: Run Update Site Script
        run: pnpm run update:site

      - name: Commit & Push
        run: |
          git config --global user.name "robobub"
          git config --global user.email "bot@luxass.dev"
          git add ./src/data/projects.ts
          git add "./src/content/projects/*.md"

          git commit -m "chore: update site"
          git push
